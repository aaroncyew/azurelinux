diff --git a/src/textformat.c b/src/textformat.c
index 6a93890..562339b 100644
--- a/src/textformat.c
+++ b/src/textformat.c
@@ -540,6 +540,9 @@ same_leader(
     if (leader1_len == 0)
 	return (leader2_len == 0);
 
+	char_u  *lnum_line = NULL;
+    int	    line_len = 0;
+
     // If first leader has 'f' flag, the lines can be joined only if the
     // second line does not have a leader.
     // If first leader has 'e' flag, the lines can never be joined.
@@ -555,8 +558,13 @@ same_leader(
 		return FALSE;
 	    if (*p == COM_START)
 	    {
-		if (*(ml_get(lnum) + leader1_len) == NUL)
-		    return FALSE;
+			if (lnum_line == NULL)
+			{
+		    	lnum_line = ml_get(lnum);
+		    	line_len = (int)STRLEN(lnum_line);
+			}
+			if (line_len <= leader1_len)
+		    	return FALSE;
 		if (leader2_flags == NULL || leader2_len == 0)
 		    return FALSE;
 		for (p = leader2_flags; *p && *p != ':'; ++p)
