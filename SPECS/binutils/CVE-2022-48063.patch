From a100f1296468e5e1fef9f22a42657301e06671a0 Mon Sep 17 00:00:00 2001
From: Sindhu <lakarri@microsoft.com>
Date: Wed, 6 Sep 2023 02:04:34 +0000
Subject: [PATCH] Patch binutils to fix CVE-2022-48063

---

From: Nick Clifton <nickc@redhat.com>
Date: Wed, 21 Dec 2022 11:51:23 +0000 (+0000)
Subject: Fix an attempt to allocate an unreasonably large amount of memory when parsing a... 
X-Git-Tag: binutils-2_40~197
X-Git-Url: https://sourceware.org/git/?p=binutils-gdb.git;a=commitdiff_plain;h=75393a2d54bcc40053e5262a3de9d70c5ebfbbfd

Fix an attempt to allocate an unreasonably large amount of memory when parsing a corrupt ELF file.

	PR  29924
	* objdump.c (load_specific_debug_section): Check for excessively
	large sections.
---

 binutils/ChangeLog | 6 ++++++
 binutils/objdump.c | 4 +++-
 2 files changed, 9 insertions(+), 1 deletion(-)

diff --git a/binutils/ChangeLog b/binutils/ChangeLog
index 7869e1b9..5267e8b1 100644
--- a/binutils/ChangeLog
+++ b/binutils/ChangeLog
@@ -1,3 +1,9 @@
+2022-12-21  Nick Clifton  <nickc@redhat.com>
+
+	PR  29924
+	* objdump.c (load_specific_debug_section): Check for excessively
+	large sections.
+
 2021-07-16  Nick Clifton  <nickc@redhat.com>
 
 	* po/sv.po: Updated Swedish translation.
diff --git a/binutils/objdump.c b/binutils/objdump.c
index a7b8303b..1e2e8395 100644
--- a/binutils/objdump.c
+++ b/binutils/objdump.c
@@ -3630,7 +3630,9 @@ load_specific_debug_section (enum dwarf_section_display_enum debug,
   section->size = bfd_section_size (sec);
   /* PR 24360: On 32-bit hosts sizeof (size_t) < sizeof (bfd_size_type). */
   alloced = amt = section->size + 1;
-  if (alloced != amt || alloced == 0)
+  if (alloced != amt
+      || alloced == 0
+      || (bfd_get_size (abfd) != 0 && alloced >= bfd_get_size (abfd)))
     {
       section->start = NULL;
       free_debug_section (debug);
-- 
2.34.1

