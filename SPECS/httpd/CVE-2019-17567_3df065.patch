From 3df0655fba285ba9da3b01a0b00c11f3fe0ad627 Mon Sep 17 00:00:00 2001
From: Yann Ylavic <ylavic@apache.org>
Date: Wed, 13 May 2020 14:54:51 +0000
Subject: [PATCH] mod_proxy_http: axe ap_proxy_should_override() duplicate
 checks.

git-svn-id: https://svn.apache.org/repos/asf/httpd/httpd/trunk@1877696 13f79535-47bb-0310-9956-ffa450edef68
---
 modules/proxy/mod_proxy_ajp.c  | 3 +--
 modules/proxy/mod_proxy_http.c | 5 ++---
 2 files changed, 3 insertions(+), 5 deletions(-)

diff --git a/modules/proxy/mod_proxy_ajp.c b/modules/proxy/mod_proxy_ajp.c
index 828231cf29e..76b491fca6c 100644
--- a/modules/proxy/mod_proxy_ajp.c
+++ b/modules/proxy/mod_proxy_ajp.c
@@ -498,8 +498,7 @@ static int ap_proxy_ajp_request(apr_pool_t *p, request_rec *r,
                              * error status so that an underlying error (eg HTTP_NOT_FOUND)
                              * doesn't become an HTTP_OK.
                              */
-                            if (!ap_proxy_should_override(conf, r->status)
-                                    && ap_proxy_should_override(conf, original_status)) {
+                            if (ap_proxy_should_override(conf, original_status)) {
                                 r->status = original_status;
                                 r->status_line = original_status_line;
                             }
diff --git a/modules/proxy/mod_proxy_http.c b/modules/proxy/mod_proxy_http.c
index 629f3e5ed47..8ddf884bdea 100644
--- a/modules/proxy/mod_proxy_http.c
+++ b/modules/proxy/mod_proxy_http.c
@@ -1713,7 +1713,7 @@ int ap_proxy_http_process_response(proxy_http_req_t *req)
              * if we are overriding the errors, we can't put the content
              * of the page into the brigade
              */
-            if (!ap_proxy_should_override(dconf, proxy_status)) {
+            {
                 /* read the body, pass it to the output filters */
                 apr_read_type_e mode = APR_NONBLOCK_READ;
                 int finish = FALSE;
@@ -1723,8 +1723,7 @@ int ap_proxy_http_process_response(proxy_http_req_t *req)
                  * error status so that an underlying error (eg HTTP_NOT_FOUND)
                  * doesn't become an HTTP_OK.
                  */
-                if (!ap_proxy_should_override(dconf, proxy_status)
-                        && ap_proxy_should_override(dconf, original_status)) {
+                if (ap_proxy_should_override(dconf, original_status)) {
                     r->status = original_status;
                     r->status_line = original_status_line;
                 }
