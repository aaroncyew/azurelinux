From 70eff2d8e622027673ec44269a98ecdfee06ab3f Mon Sep 17 00:00:00 2001
From: Yann Ylavic <ylavic@apache.org>
Date: Thu, 7 Jan 2021 17:16:19 +0000
Subject: [PATCH] mod_proxy_wstunnel: follow up to r1885239: use
 ap_find_linked_module().

git-svn-id: https://svn.apache.org/repos/asf/httpd/httpd/trunk@1885244 13f79535-47bb-0310-9956-ffa450edef68
---
 modules/proxy/mod_proxy_wstunnel.c | 13 ++-----------
 1 file changed, 2 insertions(+), 11 deletions(-)

diff --git a/modules/proxy/mod_proxy_wstunnel.c b/modules/proxy/mod_proxy_wstunnel.c
index 3815769bd41..46749dfb399 100644
--- a/modules/proxy/mod_proxy_wstunnel.c
+++ b/modules/proxy/mod_proxy_wstunnel.c
@@ -409,17 +409,8 @@ static int proxy_wstunnel_handler(request_rec *r, proxy_worker *worker,
 static int proxy_wstunnel_post_config(apr_pool_t *pconf, apr_pool_t *plog,
                                       apr_pool_t *ptemp, server_rec *s)
 {
-    fallback_to_mod_proxy_http = 0;
-    if (ap_state_query(AP_SQ_MAIN_STATE) != AP_SQ_MS_CREATE_PRE_CONFIG) {
-        apr_size_t i = 0;
-        const module *mod;
-        while ((mod = ap_loaded_modules[i++])) {
-            if (strcmp(mod->name, "mod_proxy_http.c") == 0) {
-                fallback_to_mod_proxy_http = 1;
-                break;
-            }
-        }
-    }
+    fallback_to_mod_proxy_http =
+        (ap_find_linked_module("mod_proxy_http.c") != NULL);
 
     return OK;
 }
