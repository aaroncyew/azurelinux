Original text from the patch below begins:

commit af6dedd715f4307669366944cca6e0417b290282
Author: James Zern <jzern@google.com>
Date:   Mon Sep 25 18:53:41 2023 -0700

    encode_api_test: add ConfigResizeChangeThreadCount
    
    Update thread counts and resolution to ensure allocations are updated
    correctly. VP8 is disabled to avoid a crash.
    
    Bug: chromium:1486441
    Change-Id: Ie89776d9818d27dc351eff298a44c699e850761b

Index: libvpx-1.13.0/test/encode_api_test.cc
===================================================================

Index: libvpx-1.13.0/vp8/encoder/onyx_if.c
===================================================================
Original text from the patch above ends:

Modifications to the patch for Mariner:

We are only applying one hunk from the original patch that included 4 hunks.
===================================================================
diff --git a/libvpx-1.8.2/vp8/encoder/onyx_if.c b/libvpx-1.8.2-v2/vp8/encoder/onyx_if.c
index 29c8cc6..697f73c 100644
--- a/libvpx-1.8.2/vp8/encoder/onyx_if.c
+++ b/libvpx-1.8.2-v2/vp8/encoder/onyx_if.c
@@ -1444,6 +1444,11 @@ void vp8_change_config(VP8_COMP *cpi, VP8_CONFIG *oxcf) {
   last_h = cpi->oxcf.Height;
   prev_number_of_layers = cpi->oxcf.number_of_layers;
 
+  if (cpi->initial_width) {
+    // TODO(https://crbug.com/1486441): Allow changing thread counts; the
+    // allocation is done once in vp8_create_compressor().
+    oxcf->multi_threaded = cpi->oxcf.multi_threaded;
+  }
   cpi->oxcf = *oxcf;
 
   switch (cpi->oxcf.Mode) {
